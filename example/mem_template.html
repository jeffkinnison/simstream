<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="utf-8" />
    <title>RSS Memory Reporting Test</title>

</head>

<body>

    <h1>Maximum Resident Set of the Server</h1>
    <div id="chartContainer" style="height: 300px; width: 300px;"></div>

<script src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script type="text/javascript">

window.onload = function () {
    var dps = []

    var chart = new CanvasJS.Chart("chartContainer", {
        theme: "theme2",
        title:{
			text: "Maximum Memory Usage Over Time"
		},
        axisX: {
            title: "Time"
        },
        axisY: {
            title: "Max RSS Memory Usage"
        },
		animationEnabled: false,
		data: [
		{
			type: "line",
			dataPoints: dps
		}
		]
    });
    chart.render();

    var xVal = dps.length + 1;
    var yVal = 15;
    var updateInterval = 1000;

    var updateChart = function () {
      	yVal = yVal +  Math.round(5 + Math.random() *(-5-5));

        $.ajax({
            dataType: "json",
            method: "GET",
            crossDomain: true,
            url: "http://localhost:8888/mem/rss/",
            success: function(data) {
                dps = data;
            },
            error: function(e) {
                console.log(e);
            },
            beforeSed: function(xhr) {
                xhr.setRequestHeader('X-Test-Header', 'test-value');
            }
        });

      	chart.render();
    };

setInterval(function(){updateChart()}, updateInterval);
}
</script>

</body>

</html>
